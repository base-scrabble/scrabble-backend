generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model admins {
  id             Int              @id @default(autoincrement())
  userId         Int              @unique @map("user_id")
  role           enum_admins_role @default(moderator)
  permissions    Json             @default("{}") @db.Json
  lastLoginAt    DateTime?        @map("last_login_at") @db.Timestamptz(6)
  isActive       Boolean          @default(true) @map("is_active")
  createdBy      Int?             @map("created_by")
  createdAt      DateTime         @map("created_at") @db.Timestamptz(6)
  updatedAt      DateTime         @map("updated_at") @db.Timestamptz(6)
  usersCreatedBy users?           @relation("admins_created_byTousers", fields: [createdBy], references: [id])
  usersAdmin     users            @relation("admins_user_idTousers", fields: [userId], references: [id], onDelete: Cascade)

  @@index([isActive], map: "admins_is_active")
  @@index([role], map: "admins_role")
}

model game_players {
  id           Int       @id @default(autoincrement())
  gameId       Int
  userId       Int
  playerNumber Int
  name         String    @db.VarChar(255)
  score        Int?      @default(0)
  tiles        String?   @default("[]")
  isActive     Boolean?  @default(true)
  joinedAt     DateTime? @db.Timestamptz(6)
  createdAt    DateTime  @db.Timestamptz(6)
  updatedAt    DateTime  @db.Timestamptz(6)
  games        games     @relation(fields: [gameId], references: [id], onDelete: Cascade)
  users        users     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model games {
  id                    Int                @id @default(autoincrement())
  gameCode              String             @unique @db.VarChar(255)
  status                enum_games_status  @default(waiting)
  winner                enum_games_winner?
  boardState            String?            @default("[]")
  currentTurn           Int?               @default(1)
  maxPlayers            Int?               @default(4)
  createdBy             Int
  createdAt             DateTime           @db.Timestamptz(6)
  updatedAt             DateTime           @db.Timestamptz(6)
  blockchainGameId      BigInt?
  blockchainSubmitted   Boolean            @default(false)
  submissionTxHash      String?
  submissionBlockNumber BigInt?
  submissionAttempts    Int                @default(0)
  lastSubmissionError   String?
  submissionFailed      Boolean            @default(false)
  player1Address        String?            @db.VarChar(42)
  player2Address        String?            @db.VarChar(42)
  player1Score          Int?
  player2Score          Int?
  game_players          game_players[]
  users                 users              @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  moves                 moves[]
}

model moves {
  id         Int      @id @default(autoincrement())
  gameId     Int
  userId     Int
  word       String   @db.VarChar(255)
  position   Json     @db.Json
  score      Int
  turnNumber Int
  createdAt  DateTime @db.Timestamptz(6)
  updatedAt  DateTime @db.Timestamptz(6)
  games      games    @relation(fields: [gameId], references: [id], onDelete: Cascade)
  users      users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model tournament_matches {
  id           Int                            @id @default(autoincrement())
  tournamentId Int
  roundNumber  Int
  matchNumber  Int
  status       enum_tournament_matches_status @default(scheduled)
  scorePlayer1 Int?                           @default(0)
  scorePlayer2 Int?                           @default(0)
  startAt      DateTime?                      @db.Timestamptz(6)
  endAt        DateTime?                      @db.Timestamptz(6)
  createdAt    DateTime                       @db.Timestamptz(6)
  updatedAt    DateTime                       @db.Timestamptz(6)
  loserId      Int?
  player1Id    Int
  player2Id    Int?
  winnerId     Int?
  loser        users?                         @relation("tournament_matches_loser_idTousers", fields: [loserId], references: [id])
  player1      users                          @relation("tournament_matches_player1_idTousers", fields: [player1Id], references: [id], onDelete: Cascade)
  player2      users?                         @relation("tournament_matches_player2_idTousers", fields: [player2Id], references: [id])
  tournaments  tournaments                    @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  winner       users?                         @relation("tournament_matches_winner_idTousers", fields: [winnerId], references: [id])
}

model tournament_players {
  id           Int                            @id @default(autoincrement())
  tournamentId Int
  userId       Int
  status       enum_tournament_players_status @default(registered)
  seed         Int?                           @default(0)
  ranking      Int?                           @default(0)
  wins         Int?                           @default(0)
  losses       Int?                           @default(0)
  totalScore   Int?                           @default(0)
  createdAt    DateTime                       @db.Timestamptz(6)
  updatedAt    DateTime                       @db.Timestamptz(6)
  tournaments  tournaments                    @relation(fields: [tournamentId], references: [id], onDelete: Cascade)
  users        users                          @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model tournament_schedules {
  id                   Int                                  @id @default(autoincrement())
  tournamentId         Int?
  name                 String                               @db.VarChar(100)
  type                 enum_tournament_schedules_type       @default(recurring)
  frequency            enum_tournament_schedules_frequency?
  cronExpression       String?                              @db.VarChar(255)
  startAt              DateTime?                            @db.Timestamptz(6)
  endAt                DateTime?                            @db.Timestamptz(6)
  nextRunAt            DateTime?                            @db.Timestamptz(6)
  lastRunAt            DateTime?                            @db.Timestamptz(6)
  autoStart            Boolean                              @default(false)
  minPlayers           Int                                  @default(2)
  registrationDuration Int                                  @default(3600)
  isActive             Boolean                              @default(true)
  settings             Json?                                @default("{}")
  createdAt            DateTime                             @map("created_at") @db.Timestamptz(6)
  createdBy            Int?                                 @map("created_by")
  updatedAt            DateTime                             @map("updated_at") @db.Timestamptz(6)
  tournaments          tournaments?                         @relation(fields: [tournamentId], references: [id], onDelete: Cascade)

  @@index([tournamentId])
  @@index([type])
  @@index([nextRunAt])
  @@index([isActive])
}

model tournaments {
  id                   Int                     @id @default(autoincrement())
  name                 String                  @db.VarChar(255)
  description          String?
  type                 enum_tournaments_type   @default(single_elimination)
  status               enum_tournaments_status @default(draft)
  maxPlayers           Int
  entryFee             Decimal?                @db.Decimal(10, 2)
  prizePool            Decimal?                @db.Decimal(10, 2)
  registrationStartAt  DateTime?               @db.Timestamptz(6)
  registrationEndAt    DateTime?               @db.Timestamptz(6)
  startAt              DateTime?               @db.Timestamptz(6)
  endAt                DateTime?               @db.Timestamptz(6)
  createdBy            Int                     @map("created_by")
  createdAt            DateTime                @map("created_at") @db.Timestamptz(6)
  updatedAt            DateTime                @map("updated_at") @db.Timestamptz(6)
  isActive             Boolean                 @default(true)
  rules                Json?                   @db.Json
  winnerId             Int?
  tournament_matches   tournament_matches[]
  tournament_players   tournament_players[]
  tournament_schedules tournament_schedules[]
  createdByUser        users                   @relation("tournaments_created_byTousers", fields: [createdBy], references: [id], onDelete: Cascade)
  winnerUser           users?                  @relation("tournaments_winner_idTousers", fields: [winnerId], references: [id])
}

model users {
  id                         Int                  @id @default(autoincrement())
  username                   String               @unique @db.VarChar(255)
  email                      String               @unique @db.VarChar(255)
  address                    String?              @unique @db.VarChar(255)
  avatar                     String?              @db.VarChar(255)
  password                   String?              @db.VarChar(255)
  totalScore                 Int?                 @default(0)
  gamesPlayed                Int?                 @default(0)
  gamesWon                   Int?                 @default(0)
  isActive                   Boolean              @default(true)
  createdAt                  DateTime             @db.Timestamptz(6)
  updatedAt                  DateTime             @db.Timestamptz(6)
  adminsCreated              admins[]             @relation("admins_created_byTousers")
  admin                      admins?              @relation("admins_user_idTousers")
  game_players               game_players[]
  games                      games[]
  moves                      moves[]
  tournamentMatchesAsLoser   tournament_matches[] @relation("tournament_matches_loser_idTousers")
  tournamentMatchesAsPlayer1 tournament_matches[] @relation("tournament_matches_player1_idTousers")
  tournamentMatchesAsPlayer2 tournament_matches[] @relation("tournament_matches_player2_idTousers")
  tournamentMatchesAsWinner  tournament_matches[] @relation("tournament_matches_winner_idTousers")
  tournament_players         tournament_players[]
  tournamentsCreated         tournaments[]        @relation("tournaments_created_byTousers")
  tournamentsWon             tournaments[]        @relation("tournaments_winner_idTousers")
}

enum enum_admins_role {
  super_admin
  tournament_admin
  moderator
  content_manager
}

enum enum_games_status {
  waiting
  active
  completed
  cancelled
}

enum enum_games_winner {
  player1
  player2
  draw
}

enum enum_tournament_matches_status {
  scheduled
  in_progress
  completed
  forfeit
  cancelled
}

enum enum_tournament_players_status {
  registered
  confirmed
  checked_in
  active
  eliminated
  withdrawn
  disqualified
}

enum enum_tournament_schedules_frequency {
  daily
  weekly
  monthly
  custom
}

enum enum_tournament_schedules_type {
  recurring
  one_time
}

enum enum_tournaments_status {
  draft
  registration_open
  registration_closed
  in_progress
  completed
  cancelled
}


enum enum_tournaments_type {
  single_elimination
  double_elimination
  round_robin
  swiss
}
model Waitlist {
  id            Int      @id @default(autoincrement())
  email         String   @unique
  code          String   @unique
  referrerId    Int?
  referralCount Int      @default(0)
  createdAt     DateTime @default(now())
}